---
title: "Chapter 2 潜在的結果変数の枠組み"
output: html_document
date: '2022-05-13'
---
# データ（数学の試験成績）の読込み
変数名がRのメモリ内で衝突しないように、rm(list = ls( ))としてワークスペースをクリアにする。
attach関数でデータをアクティブ化することで、分析を行う際にデータ名を指定する必要がなくなる。
```{r}
rm(list = ls())
d <- read.csv("data02.csv")
attach(d)
```
$x1$は入学試験の点数、$y3$は期末試験の点数、$t1$は補修授業受講（処置）の有無、$y0$は補修授業を受けなかった場合の期末試験の点数、$y1$は補修授業を受けた場合の期末試験の点数、
$y0t$は潜在的結果変数0（すべての学生が補修授業を受けなかった場合の期末試験の点数）、$y1t$は潜在的結果変数1（すべての学生が補修授業を受けた場合の期末試験の点数）を表す。
```{r}
head(d)
```

summary関数を使ってデータの要約統計量を表示する。
```{r}
summary(d)
```

# 処置効果1：個体因果効果
個体因果効果/個体処置効果は、「潜在的結果1-潜在的結果0」から求めることができる。しかし、実際は学生Aに補修授業を受けさせつつ、同時に学生Aに補修授業を受けさせないということは不可能（因果推論の根本問題）なため、個体因果効果を定義できても、観測も推定もできない。
```{r}
y1t - y0t  # 潜在的結果1-潜在的結果0（個体因果効果）
y3 - x1    # 期末試験-入学試験（前後比較）
y1 - y0    # 処置ありの期末試験-処置なしの期末試験
```
# 処置効果2：平均処置効果
平均因果効果/平均処置効果は、「潜在的結果変数の期待値の差」から求めることができる。
```{r}
mean(y1t) - mean(y0t)　# 潜在的結果変数の期待値の差（平均処置効果）
mean(y3) - mean(x1)    # 前後比較の平均値
m1 <- mean(y1, na.rm = TRUE)　# na.rm=TRUEと設定し、NAをremoveして計算（ペアワイズ除去）  
m0 <- mean(y0, na.rm = TRUE)
m1 - m0　# 期末試験の平均値の差           
```
tidyverseのパイプ演算子を使って平均処置効果を計算することも可能である。
```{r}
library(tidyverse)
d %>% 
  select(y1t, y0t) %>% 
  summarise(diff_mean = mean(y1t) - mean(y0t))
```

# 処置効果3：処置群の平均処置効果
ある政策をとった場合に、その政策に割り付けられた者にどれぐらい影響があったのかを、処置群の平均処置効果といい、以下の通り定義される。
$$
  \tau_{ATT} = E[Y_i(1) - Y_i(0)|T_i = 1] = E[Y_i(1)|T_i = 1] - E[Y_i(0)|T_i = 1]
$$
```{r}
mt1 <- mean(y1t[t1==1])
mt0 <- mean(y0t[t1==1])
mt1 - mt0
```

因果効果を測る推定対象として、平均処置効果と処置群の平均処置効果が最も一般的
